#开放实验
#freertos
#obsidian
#stm32pwm

# 开放实验申请失败
 - 非常困难，限制很多，且多方口径不一致，遂放弃

# stm32,第二次尝试freertos
1. (file:///C:\Users\86173\Desktop\ProjectRequirement\MCU_Now\Lin_STM32\STM32_Now\KEY_PC13_Freertos)
2. freertos,点灯+按键；尝试了多种写法
3. 对比了write与togglen的区别，与其实现区别

# 接触到了obsidian，正式开始构建个人知识库

1. 主要是vscode中，没有关系网络图，且格式单一 
2. 还有，vsc中，无法直接打开文件夹（本地文件、网址等都可以）
3. 群友提到obsidian好用

# stm32——PWM配置部分
1. psc,arr,ccr,GPIO复用，代码启动定时器
2. ccr不设置，会一直低电平
3. 公式（以周期/频率为主）
4. 启动代码在整体中的位置（例如不能再init之前）

















# 参考
## PWM部分([STM32展开——规划与控制工作分析](https://chatgpt.com/c/68d3ed7c-1468-832b-93fa-8a6e7e1b54b2))
太好了，这就是典型问题——**CCR 决定占空比，没有设置就一直低电平**。

---

总结一下关键点，以后 PWM 配置就不会出错：

1. **ARR（自动重装载）** → 决定周期
    
2. **PSC（预分频器）** → 决定计数频率
    
3. **CCR（比较寄存器）** → 决定高电平时间（占空比）
    
4. **GPIO必须复用到TIM通道**
    
5. **调用 `HAL_TIM_PWM_Start()` 启动 PWM**
    

公式回顾：

T=(ARR+1)(PSC+1)fTIM_CLK,占空比=CCRARR+1T = \frac{(ARR + 1)(PSC + 1)}{f_\text{TIM\_CLK}}, \quad 占空比 = \frac{CCR}{ARR+1}

---

✅ 经验小贴士：

- CubeMX设置Pulse就是写入 CCR
    
- 占空比动态调整可以直接用：
    

```c
__HAL_TIM_SET_COMPARE(&htim2, TIM_CHANNEL_1, newCCR);
```

- ARR/PSC设置后，PWM频率 = 1/T，CCR控制高低比例
    

---

如果你愿意，我可以画一张 **PWM波形 + CNT/ARR/CCR对比图**，一眼就看懂 TIM2 是怎么把计数器转成电平的。

你想让我画吗？

## 类似代码放置位置错误
明白，你想搞清楚 **CubeMX/HAL生成的初始化代码里，哪些函数调用如果位置放错，会导致外设不工作或异常**，不仅是 `HAL_TIM_PWM_Start()`。我帮你系统整理一下。

---

# 🟢 STM32 HAL 初始化常见顺序陷阱

## 1️⃣ 时钟系统（SystemClock_Config）

```c
SystemClock_Config();
```

**要求**：必须在大部分外设初始化之前完成  
**如果放错**：

- 外设时钟没开 → 初始化失败
    
- 定时器、UART、SPI 等都会不工作
    

---

## 2️⃣ HAL_Init()

```c
HAL_Init();
```

- 初始化 HAL 库、滴答定时器（SysTick）
    
- **必须最先调用**
    
- 放错：延迟、SysTick中断异常、延时函数 `HAL_Delay()` 不工作
    

---

## 3️⃣ 外设初始化函数（MX_XXX_Init）

例如：

```c
MX_GPIO_Init();
MX_TIM2_Init();
MX_USART1_UART_Init();
```

**规则**：

1. **GPIO先于外设IO用到的外设**
    
    - TIM PWM输出 → GPIO必须先初始化复用模式
        
    - UART TX/RX → GPIO先初始化为AF模式
        
2. **外设初始化顺序**：
    
    - TIM初始化 → 设置ARR/PSC/CCR
        
    - 然后启动 PWM/OC（`HAL_TIM_PWM_Start()`）
        

**常见错误**：

- `HAL_TIM_PWM_Start()` 写在 `MX_TIM2_Init()` 之前 → GPIO不翻转
    
- UART `HAL_UART_Transmit_IT()` 写在 `MX_USARTx_UART_Init()` 之前 → 不会发送
    

---

## 4️⃣ PWM/ADC/DAC/USART启动函数

- **TIM**：`HAL_TIM_PWM_Start()`, `HAL_TIM_Base_Start_IT()`
    
- **ADC**：`HAL_ADC_Start()`, `HAL_ADC_Start_IT()`
    
- **DAC**：`HAL_DAC_Start()`
    
- **USART**：`HAL_UART_Receive_IT()`, `HAL_UART_Transmit_IT()`
    

**位置要求**：

- 必须在对应外设 **初始化函数之后**
    
- 放在初始化之前 → 外设寄存器未配置 → 无输出/无中断
    

---

## 5️⃣ 中断使能（NVIC配置）

- CubeMX会生成 NVIC 初始化代码（优先级、使能）
    
- 必须在 **外设初始化之后**
    
- 放在 HAL_TIM_PWM_Start() 之前通常没问题，但放在 HAL_Init() 前 → NVIC优先级异常
    

---

## 6️⃣ 循环体和定时启动顺序

```c
MX_TIM2_Init();
HAL_TIM_PWM_Start(&htim2, TIM_CHANNEL_1);

while(1)
{
  // 主循环逻辑
}
```

- **初始化 → 启动 → 循环**
    
- 如果把 `HAL_TIM_PWM_Start()` 放在 while(1) 里，可能每次循环都重复启动 → 不会导致致命错误，但效率差、可能出现异常
    

---

## ✅ 总结规律

1. **HAL_Init() → SystemClock_Config() → GPIO初始化 → 外设初始化 → 外设启动/使能 → 主循环**
    
2. **TIM/ADC/PWM/DAC/UART启动函数必须在对应 MX_XXX_Init() 之后**
    
3. **GPIO复用必须先于外设输出**
    
4. **CCR/ARR/PSC/占空比设置必须在启动函数之前**
    

---

💡 **经验技巧**：

- CubeMX生成的初始化函数 **不要随意调整顺序**
    
- 外设启动函数（Start/Start_IT/Start_DMA）放在初始化之后
    
- 如果需要动态调整参数 → 用 `__HAL_TIM_SET_COMPARE()` 或 HAL函数
    

---

我可以帮你画一张 **STM32 HAL初始化顺序流程图**，把 HAL_Init、SystemClock_Config、GPIO、MX_XXX_Init、启动函数、主循环 的顺序和依赖关系全部标出来，一眼看懂“哪些函数位置错误会导致外设不工作”。

你希望我画吗？