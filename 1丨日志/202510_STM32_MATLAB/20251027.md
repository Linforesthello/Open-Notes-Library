#嵌入式代码Freertos架构规范

# 改进OMF_UARTFeedback
[电机控制改进方案](https://chatgpt.com/c/68fc64ae-7900-8323-a267-75496e75d518)
1. 分立程序块改进
	1. 改进串口与MotorControl配合![[Pasted image 20251027121513.png]]
	2. 改进测速代码溢出隐患![[Pasted image 20251027124215.png]]
	3. 改进freertos延时
		1. 在这里，把电机停止后的延时时间消掉；![[Pasted image 20251027121527.png]]![[Pasted image 20251027121927.png]]
		2. 之前改过了串口配合，使用了freertos消息队列传递控制状态标志位；配合现在消掉了停止延时，当前可以做到多发在线响应，且支持中途调换![[Pasted image 20251027122115.png]]，
		3. 不过如何在电机作用时，使其发生意外中断，仍待解决
2. 模块化改进，Freertos-MotorControl
	1. 将命令接收-解析-控制，与freertos分开，写入单个.c/.h程序![[Pasted image 20251027151427.png]]
3. 确立Freertos下，模块化的代码架构
	1. 确定，Freertos只是通信与调度架构；并不是所有代码容纳其中为好；而是要分离与分立
	2. 基于keil-mdk的代码架构
		1. ![[Pasted image 20251027191541.png]]
	3. motor.c/.h
		1. ![[Pasted image 20251027191616.png]]
	4. command.c/.h
		1. ![[Pasted image 20251027191639.png]]
4. 改写了command，成功实现输入字符串数据，来改变速度与方向
	1. 用到了一个函数式，atoi，ascii字符串转化为整数
		1. [电机控制改进方案](https://chatgpt.com/c/68fc64ae-7900-8323-a267-75496e75d518)![[Pasted image 20251027214222.png]]